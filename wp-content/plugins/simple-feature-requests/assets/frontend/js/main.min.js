!function(_,r){var u={cache:function(){u.vars={},u.vars.vote_button_selector="[data-jck-sfr-vote]",u.vars.button_status_classes={voting:"jck-sfr-vote-button--voting",voted:"jck-sfr-vote-button--voted"},u.vars.toggle_button_selector="[data-jck-sfr-toggle]",u.vars.toggle_user_type_selector="[data-jck-sfr-toggle-submission-user-type]",u.els={},u.els.container=_(".jck-sfr-container"),u.els.filters=_(".jck-sfr-filters"),u.els.submission_form={form:_(".jck-sfr-form--submission"),title:_(".jck-sfr-form--submission .jck-sfr-form__title"),reveal:_(".jck-sfr-form--submission .jck-sfr-form__reveal"),loader:_(".jck-sfr-search-field__icon--loader"),clear:_(".jck-sfr-search-field__icon--clear"),choices:{container:_(".jck-sfr-form--submission .jck-sfr-form__choices"),count:_(".jck-sfr-form--submission .jck-sfr-form__choices-count"),vote:_(".jck-sfr-form--submission .jck-sfr-form__choices-vote"),or:_(".jck-sfr-form--submission .jck-sfr-form__choices-or"),post:_(".jck-sfr-form--submission .jck-sfr-form__choices-post")}},u.els.loop={container:_(".jck-sfr-content")}},on_ready:function(){u.cache(),u.setup_vote_buttons(),u.setup_toggle_buttons(),u.setup_toggle_user_type(),u.setup_submission_form()},setup_vote_buttons:function(){_(r).on("click",u.vars.vote_button_selector,function(){var s=_(this);u.is_voting(s)||(u.has_user_voted(s)?u.update_vote_count(s,"remove"):u.update_vote_count(s,"add"))})},update_vote_count:function(e,t){var o=e.text(),r=e.attr("class");u.add_button_status_class(e,"voting"),e.text(jck_sfr_vars.il8n.voting+"...");var s=u.get_post_id(e),i=e.closest(".jck-sfr-vote-badge"),n=i.find(".jck-sfr-vote-badge__count strong"),c=i.find(".jck-sfr-vote-badge__count span"),a={action:"jck_sfr_update_vote_count",post_id:s,type:t,nonce:jck_sfr_vars.nonce};_.post(jck_sfr_vars.ajax_url,a,function(s){return s.success?("add"===t?(e.text(jck_sfr_vars.il8n.voted),u.add_button_status_class(e,"voted")):(u.remove_button_status_classes(e),e.text(jck_sfr_vars.il8n.vote)),n.text(s.votes),void c.text(s.votes_wording)):(u.display_notice(s.message,"error"),void e.attr("class",r).text(o))})},display_notice:function(s,e){alert(s)},get_post_id:function(s){return parseInt(s.data("jck-sfr-vote"))},has_user_voted:function(s){return s.hasClass(u.vars.button_status_classes.voted)},is_voting:function(s){return s.hasClass(u.vars.button_status_classes.voting)},add_button_status_class:function(s,e){u.remove_button_status_classes(s),s.addClass(u.vars.button_status_classes[e])},remove_button_status_classes:function(t){_.each(u.vars.button_status_classes,function(s,e){t.removeClass(e)})},setup_toggle_buttons:function(){_(r).on("click",u.vars.toggle_button_selector,function(){var s=_(this);_(".jck-sfr-js-toggle-"+s.data("jck-sfr-toggle")).toggle()})},setup_toggle_user_type:function(){_(r).on("click",u.vars.toggle_user_type_selector,function(){var s=_(this).data("jck-sfr-toggle-submission-user-type");_('[name="jck-sfr-login-user-type"]').val(s)})},setup_submission_form:function(){if(!(u.els.submission_form.form.length<=0)){u.els.submission_form.title.keypress(function(s){13===s.which&&s.preventDefault()});var e=null;u.els.submission_form.title.keyup(function(s){clearTimeout(e),e=setTimeout(function(){u.search_feature_requests(s.target.value)},500)}),u.els.submission_form.choices.post.on("click",function(){return u.reveal_submission_form(),!1}),_(".jck-sfr-js-clear-search-field").on("click",function(){u.els.submission_form.title.val("").keyup(),_(this).hide()})}},search_feature_requests:function(e){u.update_query_args("search",e),u.toggle_loader("show");var s={action:"jck_sfr_search_feature_requests",nonce:jck_sfr_vars.nonce,paged:jck_sfr_vars.paged};_.extend(s,u.get_url_parameters(window.location.href)),s.search=e,_.post(jck_sfr_vars.ajax_url,s,function(s){if(!s.success&&!s.html)return u.display_notice(s.message,"error"),void u.toggle_loader("hide");!s.success&&0<e.length?u.reveal_submission_form():u.hide_submission_form(),u.els.loop.container.html(s.html),u.replace_pagination(s.pagination),u.toggle_filters(s),u.toggle_choices(s),u.toggle_loader("hide")})},update_query_args:function(s,e){s=encodeURIComponent(s);var t=window.location.href,o=u.get_url_parameters(t);0<e.length?o[s]=e:delete o[s],t=t.split("?")[0],0<_.param(o).length&&(t+="?"+_.param(o)),window.history.pushState({key:s,value:e},r.title,t)},get_url_parameters:function(s){var e={},t=s.indexOf("?");if(-1===t)return e;for(var o=s.substring(t+1).split("&"),r=0;r<o.length;r++){var i=o[r].split("=");e[i[0]]=i[1]}return e},replace_pagination:function(s){_(".jck-sfr-pagination").length<=0||_(".jck-sfr-pagination").replaceWith(s)},toggle_filters:function(s){u.els.filters.hide(),s.search.length<=0&&u.els.filters.show()},toggle_choices:function(s){u.els.submission_form.choices.vote.show(),u.els.submission_form.choices.or.show(),u.els.submission_form.choices.post.show(),u.els.submission_form.choices.count.text(s.count),u.els.submission_form.choices.container.show(),(s.count<=0||s.search.length<=0)&&u.els.submission_form.choices.container.hide()},reveal_submission_form:function(){u.els.submission_form.choices.or.hide(),u.els.submission_form.choices.post.hide(),u.els.submission_form.reveal.show(),u.focus_submission_title()},hide_submission_form:function(){u.els.submission_form.reveal.hide()},focus_submission_title:function(){var s=u.els.submission_form.title.val();u.els.submission_form.title.focus(),u.els.submission_form.title.val("").val(s)},toggle_loader:function(s){void 0!==s&&("show"===s?(u.els.submission_form.clear.hide(),u.els.submission_form.loader.show()):(u.els.submission_form.loader.hide(),0<u.els.submission_form.title.val().length&&u.els.submission_form.clear.show()))}};_(r).ready(u.on_ready)}(jQuery,document);