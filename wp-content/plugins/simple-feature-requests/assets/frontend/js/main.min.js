(function(s,e){var t={cache:function(){t.vars={},t.vars.vote_button_selector="[data-jck-sfr-vote]",t.vars.button_status_classes={voting:"jck-sfr-vote-button--voting",voted:"jck-sfr-vote-button--voted"},t.vars.toggle_button_selector="[data-jck-sfr-toggle]",t.vars.toggle_user_type_selector="[data-jck-sfr-toggle-submission-user-type]",t.els={},t.els.container=s(".jck-sfr-container"),t.els.filters=s(".jck-sfr-filters"),t.els.submission_form={form:s(".jck-sfr-form--submission"),title:s(".jck-sfr-form--submission .jck-sfr-form__title"),reveal:s(".jck-sfr-form--submission .jck-sfr-form__reveal"),loader:s(".jck-sfr-search-field__icon--loader"),clear:s(".jck-sfr-search-field__icon--clear"),choices:{container:s(".jck-sfr-form--submission .jck-sfr-form__choices"),count:s(".jck-sfr-form--submission .jck-sfr-form__choices-count"),vote:s(".jck-sfr-form--submission .jck-sfr-form__choices-vote"),or:s(".jck-sfr-form--submission .jck-sfr-form__choices-or"),post:s(".jck-sfr-form--submission .jck-sfr-form__choices-post")}},t.els.loop={container:s(".jck-sfr-content")}},on_ready:function(){t.cache(),t.setup_vote_buttons(),t.setup_toggle_buttons(),t.setup_toggle_user_type(),t.setup_submission_form(),t.setup_image_uploader(),t.setup_image_gallery()},setup_vote_buttons:function(){s(e).on("click",t.vars.vote_button_selector,function(){var e=s(this);t.is_voting(e)||(t.has_user_voted(e)?t.update_vote_count(e,"remove"):t.update_vote_count(e,"add"))})},update_vote_count:function(e,o){var n=e.text(),i=e.attr("class");t.add_button_status_class(e,"voting"),e.text(jck_sfr_vars.il8n.voting+"...");var r=t.get_post_id(e),a=e.closest(".jck-sfr-vote-badge"),c=a.find(".jck-sfr-vote-badge__count strong"),_=a.find(".jck-sfr-vote-badge__count span"),u={action:"jck_sfr_update_vote_count",post_id:r,type:o,nonce:jck_sfr_vars.nonce};s.post(jck_sfr_vars.ajax_url,u,function(s){return s.success?"add"===o?(e.text(jck_sfr_vars.il8n.voted),t.add_button_status_class(e,"voted"),c.text(s.votes),void _.text(s.votes_wording)):(t.remove_button_status_classes(e),e.text(jck_sfr_vars.il8n.vote),c.text(s.votes),void _.text(s.votes_wording)):(t.display_notice(s.message,"error"),void e.attr("class",i).text(n))})},display_notice:function(s,e){alert(s)},get_post_id:function(s){return parseInt(s.data("jck-sfr-vote"))},has_user_voted:function(s){return s.hasClass(t.vars.button_status_classes.voted)},is_voting:function(s){return s.hasClass(t.vars.button_status_classes.voting)},add_button_status_class:function(s,e){t.remove_button_status_classes(s),s.addClass(t.vars.button_status_classes[e])},remove_button_status_classes:function(e){s.each(t.vars.button_status_classes,function(s,t){e.removeClass(t)})},setup_toggle_buttons:function(){s(e).on("click",t.vars.toggle_button_selector,function(){var e=s(this),t=s(".jck-sfr-js-toggle-"+e.data("jck-sfr-toggle"));t.toggle()})},setup_toggle_user_type:function(){s(e).on("click",t.vars.toggle_user_type_selector,function(){var e=s(this),t=e.data("jck-sfr-toggle-submission-user-type");s('[name="jck-sfr-login-user-type"]').val(t)})},setup_submission_form:function(){if(!(t.els.submission_form.form.length<=0)){t.els.submission_form.title.keypress(function(s){13===s.which&&s.preventDefault()});var e=null;t.els.submission_form.title.keyup(function(s){clearTimeout(e),e=setTimeout(function(){t.search_feature_requests(s.target.value)},500)}),t.els.submission_form.choices.post.on("click",function(){return t.reveal_submission_form(),!1}),s(".jck-sfr-js-clear-search-field").on("click",function(){t.els.submission_form.title.val("").keyup(),s(this).hide()})}},search_feature_requests:function(e){t.update_query_args("search",e),t.toggle_loader("show");var o={action:"jck_sfr_search_feature_requests",nonce:jck_sfr_vars.nonce,paged:jck_sfr_vars.paged};s.extend(o,t.get_url_parameters(window.location.href)),o.search=e,s.post(jck_sfr_vars.ajax_url,o,function(s){if(!s.success&&!s.html)return t.display_notice(s.message,"error"),void t.toggle_loader("hide");!s.success&&e.length>0?t.reveal_submission_form():t.hide_submission_form(),t.els.loop.container.html(s.html),t.replace_pagination(s.pagination),t.toggle_filters(s),t.toggle_choices(s),t.toggle_loader("hide")})},update_query_args:function(o,n){o=encodeURIComponent(o);var i=window.location.href,r=t.get_url_parameters(i);n.length>0?r[o]=n:delete r[o],i=i.split("?")[0],s.param(r).length>0&&(i+="?"+s.param(r)),window.history.pushState({key:o,value:n},e.title,i)},get_url_parameters:function(s){var e={},t=s.indexOf("?");if(-1===t)return e;for(var o=s.substring(t+1),n=o.split("&"),i=0;i<n.length;i++){var r=n[i].split("=");e[r[0]]=r[1]}return e},replace_pagination:function(e){s(".jck-sfr-pagination").length<=0||s(".jck-sfr-pagination").replaceWith(e)},toggle_filters:function(s){t.els.filters.hide(),s.search.length<=0&&t.els.filters.show()},toggle_choices:function(s){t.els.submission_form.choices.vote.show(),t.els.submission_form.choices.or.show(),t.els.submission_form.choices.post.show(),t.els.submission_form.choices.count.text(s.count),t.els.submission_form.choices.container.show(),(s.count<=0||s.search.length<=0)&&t.els.submission_form.choices.container.hide()},reveal_submission_form:function(){t.els.submission_form.choices.or.hide(),t.els.submission_form.choices.post.hide(),t.els.submission_form.reveal.show(),t.focus_submission_title()},hide_submission_form:function(){t.els.submission_form.reveal.hide()},focus_submission_title:function(){var s=t.els.submission_form.title.val();t.els.submission_form.title.focus(),t.els.submission_form.title.val("").val(s)},toggle_loader:function(s){void 0!==s&&("show"===s?(t.els.submission_form.clear.hide(),t.els.submission_form.loader.show()):(t.els.submission_form.loader.hide(),t.els.submission_form.title.val().length>0&&t.els.submission_form.clear.show()))},setup_image_uploader:function(){if("undefined"!=typeof Dropzone){var e=s("#jck-sfr-image-uploader");if(!e.length)return;var o=t.els.submission_form.form.find(".jck-sfr-form__button");e.dropzone({url:jck_sfr_vars.ajax_url,params:{action:"jck_sfr_set_feature_request_attachments",nonce:jck_sfr_vars.attachment_nonce},init:function(){t.check_for_already_submitted_attachments(e,this),this.on("successmultiple",function(t,o){o.success&&o.data.attachment_ids&&(e.find('[name="attachment_ids[]"]').remove(),s.each(o.data.attachment_ids,function(s,t){e.append('<input type="hidden" name="attachment_ids[]" value="'+t+'" />')}))}),this.on("processingmultiple",function(){o.prop("disabled",!0)}),this.on("successmultiple",function(){o.removeAttr("disabled"),o.trigger("click")}),this.on("removedfile",function(e){e.attachment_id&&s('[name="attachment_ids[]"][value="'+e.attachment_id+'"]').remove()})},acceptedFiles:"image/*",uploadMultiple:!0,paramName:"attachments",autoProcessQueue:!1,addRemoveLinks:!0,hiddenInputContainer:e[0],maxFiles:5,maxFilesize:jck_sfr_vars.attachments_max_filesize,parallelUploads:5});var n=Dropzone.forElement(e.get(0));t.els.submission_form.form.on("submit",function(s){n.getQueuedFiles().length&&(s.preventDefault(),n.processQueue())})}},check_for_already_submitted_attachments:function(e,t){if("undefined"!=typeof Dropzone){var o=e.find('[name="attachment_ids[]"]');if(!o.length)return;var n=o.toArray().map(function(e){return s(e).val()});s.get({url:jck_sfr_vars.ajax_url,data:{action:"jck_sfr_get_feature_request_attachments",nonce:jck_sfr_vars.attachment_nonce,attachment_ids:n},success:function(e){e.success&&e.data.attachments&&s.each(e.data.attachments,function(s,e){var o={name:e.name,size:e.size,attachment_id:s};t.emit("addedfile",o),t.options.thumbnail.call(t,o,e.url),t.emit("complete",o)})}})}},setup_image_gallery:function(){var e=s(".jck-sfr-attachments");e.length&&e.on("click",".jck-sfr-attachment",function(){var e=s(this).parent().find(".jck-sfr-attachment"),t=[];e.each(function(){var e=s(this).find("img");e&&t.push({src:e.data("src"),w:e.data("width"),h:e.data("height")})});var o=new PhotoSwipe(s(".pswp").get(0),PhotoSwipeUI_Default,t,{index:0});o.init()})}};"undefined"!=typeof Dropzone&&null!==Dropzone&&jck_sfr_vars.allow_attachments&&(Dropzone.autoDiscover=!1),s(e).ready(t.on_ready)})(jQuery,document);