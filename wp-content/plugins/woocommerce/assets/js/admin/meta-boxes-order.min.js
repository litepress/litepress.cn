jQuery(function(u){window.wcTracks=window.wcTracks||{},window.wcTracks.recordEvent=window.wcTracks.recordEvent||function(){};var p={states:null,init:function(){"undefined"!=typeof woocommerce_admin_meta_boxes_order&&"undefined"!=typeof woocommerce_admin_meta_boxes_order.countries&&(this.states=JSON.parse(woocommerce_admin_meta_boxes_order.countries.replace(/&quot;/g,'"'))),u(".js_field-country").selectWoo().on("change",this.change_country),u(".js_field-country").trigger("change",[!0]),u(document.body).on("change","select.js_field-state",this.change_state),u("#woocommerce-order-actions input, #woocommerce-order-actions a").on("click",function(){window.onbeforeunload=""}),u("a.edit_address").on("click",this.edit_address),u("a.billing-same-as-shipping").on("click",this.copy_billing_to_shipping),u("a.load_customer_billing").on("click",this.load_billing),u("a.load_customer_shipping").on("click",this.load_shipping),u("#customer_user").on("change",this.change_customer_user)},change_country:function(e,o){var t,r,a,i,n,d,c,_,s,m,l;void 0===o&&(o=!1),null!==p.states&&(r=(t=u(this)).val(),m=(a=t.parents("div.edit_address").find(":input.js_field-state")).parent(),i=a.val(),n=a.attr("name"),d=a.attr("id"),c=t.data("woocommerce.stickState-"+r)?t.data("woocommerce.stickState-"+r):i,_=a.attr("placeholder"),o&&t.data("woocommerce.stickState-"+r,c),m.show().find(".select2-container").remove(),u.isEmptyObject(p.states[r])?(l=u('<input type="text" />').prop("id",d).prop("name",n).prop("placeholder",_).addClass("js_field-state").val(i),a.replaceWith(l)):(s=p.states[r],m=u('<option value=""></option>').text(woocommerce_admin_meta_boxes_order.i18n_select_state_text),l=u("<select></select>").prop("id",d).prop("name",n).prop("placeholder",_).addClass("js_field-state select short").append(m),u.each(s,function(e){var o=u("<option></option>").prop("value",e).text(s[e]);e===i&&o.prop("selected"),l.append(o)}),l.val(c),a.replaceWith(l),l.show().selectWoo().hide().trigger("change")),u(document.body).trigger("contry-change.woocommerce",[r,u(this).closest("div")]),u(document.body).trigger("country-change.woocommerce",[r,u(this).closest("div")]))},change_state:function(){var e=u(this),o=e.val(),t=e.parents("div.edit_address").find(":input.js_field-country"),e=t.val();t.data("woocommerce.stickState-"+e,o)},init_tiptip:function(){u("#tiptip_holder").removeAttr("style"),u("#tiptip_arrow").removeAttr("style"),u(".tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200,keepAlive:!0})},edit_address:function(e){e.preventDefault();var o=u(this),t=o.closest(".order_data_column"),r=t.find("div.edit_address"),a=t.find("div.address"),i=r.find(".js_field-country"),e=r.find(".js_field-state"),t=Boolean(r.find('input[name^="_billing_"]').length);a.hide(),o.parent().find("a").toggle(),i.val()||(i.val(woocommerce_admin_meta_boxes_order.default_country).trigger("change"),e.val(woocommerce_admin_meta_boxes_order.default_state).trigger("change")),r.show();t=t?"order_edit_billing_address_click":"order_edit_shipping_address_click";window.wcTracks.recordEvent(t,{order_id:woocommerce_admin_meta_boxes.post_id,status:u("#order_status").val()})},change_customer_user:function(){u("#_billing_country").val()||(u("a.edit_address").trigger("click"),p.load_billing(!0),p.load_shipping(!0))},load_billing:function(e){if(!0===e||window.confirm(woocommerce_admin_meta_boxes.load_billing)){e=u("#customer_user").val();if(!e)return window.alert(woocommerce_admin_meta_boxes.no_customer_selected),!1;e={user_id:e,action:"woocommerce_get_customer_details",security:woocommerce_admin_meta_boxes.get_customer_details_nonce};u(this).closest("div.edit_address").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),u.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:e,type:"POST",success:function(e){e&&e.billing&&u.each(e.billing,function(e,o){u(":input#_billing_"+e).val(o).trigger("change")}),u("div.edit_address").unblock()}})}return!1},load_shipping:function(e){if(!0===e||window.confirm(woocommerce_admin_meta_boxes.load_shipping)){e=u("#customer_user").val();if(!e)return window.alert(woocommerce_admin_meta_boxes.no_customer_selected),!1;e={user_id:e,action:"woocommerce_get_customer_details",security:woocommerce_admin_meta_boxes.get_customer_details_nonce};u(this).closest("div.edit_address").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),u.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:e,type:"POST",success:function(e){e&&e.billing&&u.each(e.shipping,function(e,o){u(":input#_shipping_"+e).val(o).trigger("change")}),u("div.edit_address").unblock()}})}return!1},copy_billing_to_shipping:function(){return window.confirm(woocommerce_admin_meta_boxes.copy_billing)&&u('.order_data_column :input[name^="_billing_"]').each(function(){var e=(e=u(this).attr("name")).replace("_billing_","_shipping_");u(":input#"+e).val(u(this).val()).trigger("change")}),!1}},d={init:function(){this.stupidtable.init(),u("#woocommerce-order-items").on("click","button.add-line-item",this.add_line_item).on("click","button.add-coupon",this.add_coupon).on("click","a.remove-coupon",this.remove_coupon).on("click","button.refund-items",this.refund_items).on("click",".cancel-action",this.cancel).on("click",".refund-actions .cancel-action",this.track_cancel).on("click","button.add-order-item",this.add_item).on("click","button.add-order-fee",this.add_fee).on("click","button.add-order-shipping",this.add_shipping).on("click","button.add-order-tax",this.add_tax).on("click","button.save-action",this.save_line_items).on("click","a.delete-order-tax",this.delete_tax).on("click","button.calculate-action",this.recalculate).on("click","a.edit-order-item",this.edit_item).on("click","a.delete-order-item",this.delete_item).on("click",".delete_refund",this.refunds.delete_refund).on("click","button.do-api-refund, button.do-manual-refund",this.refunds.do_refund).on("change",".refund input.refund_line_total, .refund input.refund_line_tax",this.refunds.input_changed).on("change keyup",".wc-order-refund-items #refund_amount",this.refunds.amount_changed).on("change","input.refund_order_item_qty",this.refunds.refund_quantity_changed).on("change","input.quantity",this.quantity_changed).on("keyup change",".split-input :input",function(){var e=u(this).parent().prev().find(":input");e&&(""===e.val()||e.is(".match-total"))&&e.val(u(this).val()).addClass("match-total")}).on("keyup",".split-input :input",function(){u(this).removeClass("match-total")}).on("click","button.add_order_item_meta",this.item_meta.add).on("click","button.remove_order_item_meta",this.item_meta.remove).on("wc_order_items_reload",this.reload_items).on("wc_order_items_reloaded",this.reloaded_items),u(document.body).on("wc_backbone_modal_loaded",this.backbone.init).on("wc_backbone_modal_response",this.backbone.response)},block:function(){u("#woocommerce-order-items").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){u("#woocommerce-order-items").unblock()},reload_items:function(){var e={order_id:woocommerce_admin_meta_boxes.post_id,action:"woocommerce_load_order_items",security:woocommerce_admin_meta_boxes.order_item_nonce};d.block(),u.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:e,type:"POST",success:function(e){u("#woocommerce-order-items").find(".inside").empty(),u("#woocommerce-order-items").find(".inside").append(e),d.reloaded_items(),d.unblock()}})},reloaded_items:function(){p.init_tiptip(),d.stupidtable.init()},quantity_changed:function(){var i=u(this).closest("tr.item"),n=u(this).val(),d=u(this).attr("data-qty"),e=u("input.line_total",i),o=u("input.line_subtotal",i),t=accounting.unformat(e.attr("data-total"),woocommerce_admin.mon_decimal_point)/d;e.val(parseFloat(accounting.formatNumber(t*n,woocommerce_admin_meta_boxes.rounding_precision,"")).toString().replace(".",woocommerce_admin.mon_decimal_point));t=accounting.unformat(o.attr("data-subtotal"),woocommerce_admin.mon_decimal_point)/d;o.val(parseFloat(accounting.formatNumber(t*n,woocommerce_admin_meta_boxes.rounding_precision,"")).toString().replace(".",woocommerce_admin.mon_decimal_point)),u("input.line_tax",i).each(function(){var e=u(this),o=e.data("tax_id"),t=accounting.unformat(e.attr("data-total_tax"),woocommerce_admin.mon_decimal_point)/d,r=u('input.line_subtotal_tax[data-tax_id="'+o+'"]',i),a=accounting.unformat(r.attr("data-subtotal_tax"),woocommerce_admin.mon_decimal_point)/d,o="yes"===woocommerce_admin_meta_boxes.round_at_subtotal,o=woocommerce_admin_meta_boxes[o?"rounding_precision":"currency_format_num_decimals"];0<t&&e.val(parseFloat(accounting.formatNumber(t*n,o,"")).toString().replace(".",woocommerce_admin.mon_decimal_point)),0<a&&r.val(parseFloat(accounting.formatNumber(a*n,o,"")).toString().replace(".",woocommerce_admin.mon_decimal_point))}),u(this).trigger("quantity_changed")},add_line_item:function(){return u("div.wc-order-add-item").slideDown(),u("div.wc-order-data-row-toggle").not("div.wc-order-add-item").slideUp(),window.wcTracks.recordEvent("order_edit_add_items_click",{order_id:woocommerce_admin_meta_boxes.post_id,status:u("#order_status").val()}),!1},add_coupon:function(){window.wcTracks.recordEvent("order_edit_add_coupon_click",{order_id:woocommerce_admin_meta_boxes.post_id,status:u("#order_status").val()});var e,o,t,r=window.prompt(woocommerce_admin_meta_boxes.i18n_apply_coupon);return null==r?window.wcTracks.recordEvent("order_edit_add_coupon_cancel",{order_id:woocommerce_admin_meta_boxes.post_id,status:u("#order_status").val()}):(d.block(),e=u("#customer_user").val(),o=u("#_billing_email").val(),t=u.extend({},d.get_taxable_address(),{action:"woocommerce_add_coupon_discount",dataType:"json",order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.order_item_nonce,coupon:r,user_id:e,user_email:o}),u.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:t,type:"POST",success:function(e){e.success?(u("#woocommerce-order-items").find(".inside").empty(),u("#woocommerce-order-items").find(".inside").append(e.data.html),d.reloaded_items(),d.unblock()):window.alert(e.data.error),d.unblock()},complete:function(){window.wcTracks.recordEvent("order_edit_added_coupon",{order_id:t.order_id,status:u("#order_status").val()})}})),!1},remove_coupon:function(){var e=u(this);d.block();e=u.extend({},d.get_taxable_address(),{action:"woocommerce_remove_order_coupon",dataType:"json",order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.order_item_nonce,coupon:e.data("code")});u.post(woocommerce_admin_meta_boxes.ajax_url,e,function(e){e.success?(u("#woocommerce-order-items").find(".inside").empty(),u("#woocommerce-order-items").find(".inside").append(e.data.html),d.reloaded_items(),d.unblock()):window.alert(e.data.error),d.unblock()})},refund_items:function(){return u("div.wc-order-refund-items").slideDown(),u("div.wc-order-data-row-toggle").not("div.wc-order-refund-items").slideUp(),u("div.wc-order-totals-items").slideUp(),u("#woocommerce-order-items").find("div.refund").show(),u(".wc-order-edit-line-item .wc-order-edit-line-item-actions").hide(),window.wcTracks.recordEvent("order_edit_refund_button_click",{order_id:woocommerce_admin_meta_boxes.post_id,status:u("#order_status").val()}),!1},cancel:function(){return u("div.wc-order-data-row-toggle").not("div.wc-order-bulk-actions").slideUp(),u("div.wc-order-bulk-actions").slideDown(),u("div.wc-order-totals-items").slideDown(),u("#woocommerce-order-items").find("div.refund").hide(),u(".wc-order-edit-line-item .wc-order-edit-line-item-actions").show(),"true"===u(this).attr("data-reload")&&d.reload_items(),window.wcTracks.recordEvent("order_edit_add_items_cancelled",{order_id:woocommerce_admin_meta_boxes.post_id,status:u("#order_status").val()}),!1},track_cancel:function(){window.wcTracks.recordEvent("order_edit_refund_cancel",{order_id:woocommerce_admin_meta_boxes.post_id,status:u("#order_status").val()})},add_item:function(){return u(this).WCBackboneModal({template:"wc-modal-add-products"}),!1},add_fee:function(){window.wcTracks.recordEvent("order_edit_add_fee_click",{order_id:woocommerce_admin_meta_boxes.post_id,status:u("#order_status").val()});var o,e=window.prompt(woocommerce_admin_meta_boxes.i18n_add_fee);return null==e?window.wcTracks.recordEvent("order_edit_add_fee_cancel",{order_id:woocommerce_admin_meta_boxes.post_id,status:u("#order_status").val()}):(d.block(),o=u.extend({},d.get_taxable_address(),{action:"woocommerce_add_order_fee",dataType:"json",order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.order_item_nonce,amount:e}),u.post(woocommerce_admin_meta_boxes.ajax_url,o,function(e){e.success?(u("#woocommerce-order-items").find(".inside").empty(),u("#woocommerce-order-items").find(".inside").append(e.data.html),d.reloaded_items(),d.unblock(),window.wcTracks.recordEvent("order_edit_added_fee",{order_id:o.post_id,status:u("#order_status").val()})):window.alert(e.data.error),d.unblock()})),!1},add_shipping:function(){d.block();var o={action:"woocommerce_add_order_shipping",order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.order_item_nonce,dataType:"json"};return u.post(woocommerce_admin_meta_boxes.ajax_url,o,function(e){e.success?(u("table.woocommerce_order_items tbody#order_shipping_line_items").append(e.data.html),window.wcTracks.recordEvent("order_edit_add_shipping",{order_id:o.post_id,status:u("#order_status").val()})):window.alert(e.data.error),d.unblock()}),!1},add_tax:function(){return u(this).WCBackboneModal({template:"wc-modal-add-tax"}),!1},edit_item:function(){return u(this).closest("tr").find(".view").hide(),u(this).closest("tr").find(".edit").show(),u(this).hide(),u("button.add-line-item").trigger("click"),u("button.cancel-action").attr("data-reload",!0),window.wcTracks.recordEvent("order_edit_edit_item_click",{order_id:woocommerce_admin_meta_boxes.post_id,status:u("#order_status").val()}),!1},delete_item:function(){var e,o;return window.confirm(woocommerce_admin_meta_boxes.remove_item_notice)&&(e=u(this).closest("tr.item, tr.fee, tr.shipping").attr("data-order_item_id"),d.block(),o=u.extend({},d.get_taxable_address(),{order_id:woocommerce_admin_meta_boxes.post_id,order_item_ids:e,action:"woocommerce_remove_order_item",security:woocommerce_admin_meta_boxes.order_item_nonce}),"true"===u("button.cancel-action").attr("data-reload")&&(o.items=u("table.woocommerce_order_items :input[name], .wc-order-totals-items :input[name]").serialize()),u.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:o,type:"POST",success:function(e){e.success?(u("#woocommerce-order-items").find(".inside").empty(),u("#woocommerce-order-items").find(".inside").append(e.data.html),e.data.notes_html&&(u("ul.order_notes").empty(),u("ul.order_notes").append(u(e.data.notes_html).find("li"))),d.reloaded_items(),d.unblock()):window.alert(e.data.error),d.unblock()},complete:function(){window.wcTracks.recordEvent("order_edit_remove_item",{order_id:o.post_id,status:u("#order_status").val()})}})),!1},delete_tax:function(){var e;return window.confirm(woocommerce_admin_meta_boxes.i18n_delete_tax)?(d.block(),e={action:"woocommerce_remove_order_tax",rate_id:u(this).attr("data-rate_id"),order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.order_item_nonce},u.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:e,type:"POST",success:function(e){e.success?(u("#woocommerce-order-items").find(".inside").empty(),u("#woocommerce-order-items").find(".inside").append(e.data.html),d.reloaded_items(),d.unblock()):window.alert(e.data.error),d.unblock()},complete:function(){window.wcTracks.recordEvent("order_edit_delete_tax",{order_id:e.order_id,status:u("#order_status").val()})}})):window.wcTracks.recordEvent("order_edit_delete_tax_cancel",{order_id:woocommerce_admin_meta_boxes.post_id,status:u("#order_status").val()}),!1},get_taxable_address:function(){var e="",o="",t="",r="";return"shipping"===woocommerce_admin_meta_boxes.tax_based_on&&(e=u("#_shipping_country").val(),o=u("#_shipping_state").val(),t=u("#_shipping_postcode").val(),r=u("#_shipping_city").val()),"billing"!==woocommerce_admin_meta_boxes.tax_based_on&&e||(e=u("#_billing_country").val(),o=u("#_billing_state").val(),t=u("#_billing_postcode").val(),r=u("#_billing_city").val()),{country:e,state:o,postcode:t,city:r}},recalculate:function(){var o;return window.confirm(woocommerce_admin_meta_boxes.calc_totals)?(d.block(),o=u.extend({},d.get_taxable_address(),{action:"woocommerce_calc_line_taxes",order_id:woocommerce_admin_meta_boxes.post_id,items:u("table.woocommerce_order_items :input[name], .wc-order-totals-items :input[name]").serialize(),security:woocommerce_admin_meta_boxes.calc_totals_nonce}),u(document.body).trigger("order-totals-recalculate-before",o),u.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:o,type:"POST",success:function(e){u("#woocommerce-order-items").find(".inside").empty(),u("#woocommerce-order-items").find(".inside").append(e),d.reloaded_items(),d.unblock(),u(document.body).trigger("order-totals-recalculate-success",e)},complete:function(e){u(document.body).trigger("order-totals-recalculate-complete",e),window.wcTracks.recordEvent("order_edit_recalc_totals",{order_id:o.post_id,OK_cancel:"OK",status:u("#order_status").val()})}})):window.wcTracks.recordEvent("order_edit_recalc_totals",{order_id:woocommerce_admin_meta_boxes.post_id,OK_cancel:"cancel",status:u("#order_status").val()}),!1},save_line_items:function(){var e={order_id:woocommerce_admin_meta_boxes.post_id,items:u("table.woocommerce_order_items :input[name], .wc-order-totals-items :input[name]").serialize(),action:"woocommerce_save_order_items",security:woocommerce_admin_meta_boxes.order_item_nonce};return d.block(),u.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:e,type:"POST",success:function(e){e.success?(u("#woocommerce-order-items").find(".inside").empty(),u("#woocommerce-order-items").find(".inside").append(e.data.html),e.data.notes_html&&(u("ul.order_notes").empty(),u("ul.order_notes").append(u(e.data.notes_html).find("li"))),d.reloaded_items(),d.unblock()):(d.unblock(),window.alert(e.data.error))},complete:function(){window.wcTracks.recordEvent("order_edit_save_line_items",{order_id:e.post_id,status:u("#order_status").val()})}}),u(this).trigger("items_saved"),!1},refunds:{do_refund:function(){var e,o,t,r,a,i,n;d.block(),window.confirm(woocommerce_admin_meta_boxes.i18n_do_refund)?(e=u("input#refund_amount").val(),o=u("input#refund_reason").val(),t=u("input#refunded_amount").val(),r={},a={},i={},u(".refund input.refund_order_item_qty").each(function(e,o){u(o).closest("tr").data("order_item_id")&&o.value&&(r[u(o).closest("tr").data("order_item_id")]=o.value)}),u(".refund input.refund_line_total").each(function(e,o){u(o).closest("tr").data("order_item_id")&&(a[u(o).closest("tr").data("order_item_id")]=accounting.unformat(o.value,woocommerce_admin.mon_decimal_point))}),u(".refund input.refund_line_tax").each(function(e,o){var t;u(o).closest("tr").data("order_item_id")&&(t=u(o).data("tax_id"),i[u(o).closest("tr").data("order_item_id")]||(i[u(o).closest("tr").data("order_item_id")]={}),i[u(o).closest("tr").data("order_item_id")][t]=accounting.unformat(o.value,woocommerce_admin.mon_decimal_point))}),n={action:"woocommerce_refund_line_items",order_id:woocommerce_admin_meta_boxes.post_id,refund_amount:e,refunded_amount:t,refund_reason:o,line_item_qtys:JSON.stringify(r,null,""),line_item_totals:JSON.stringify(a,null,""),line_item_tax_totals:JSON.stringify(i,null,""),api_refund:u(this).is(".do-api-refund"),restock_refunded_items:u("#restock_refunded_items:checked").length?"true":"false",security:woocommerce_admin_meta_boxes.order_item_nonce},u.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:n,type:"POST",success:function(e){!0===e.success?window.location.reload():(window.alert(e.data.error),d.reload_items(),d.unblock())},complete:function(){window.wcTracks.recordEvent("order_edit_refunded",{order_id:n.order_id,status:u("#order_status").val(),api_refund:n.api_refund,has_reason:Boolean(n.refund_reason.length),restock:"true"===n.restock_refunded_items})}})):d.unblock()},delete_refund:function(){var e;return window.confirm(woocommerce_admin_meta_boxes.i18n_delete_refund)&&(e=u(this).closest("tr.refund").attr("data-order_refund_id"),d.block(),e={action:"woocommerce_delete_refund",refund_id:e,security:woocommerce_admin_meta_boxes.order_item_nonce},u.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:e,type:"POST",success:function(){d.reload_items()}})),!1},input_changed:function(){var t=0;u(".woocommerce_order_items").find("tr.item, tr.fee, tr.shipping").each(function(){u(this).find(".refund input:not(.refund_order_item_qty)").each(function(e,o){t+=parseFloat(accounting.unformat(u(o).val()||0,woocommerce_admin.mon_decimal_point))})}),u("#refund_amount").val(accounting.formatNumber(t,woocommerce_admin_meta_boxes.currency_format_num_decimals,"",woocommerce_admin.mon_decimal_point)).trigger("change")},amount_changed:function(){var e=accounting.unformat(u(this).val(),woocommerce_admin.mon_decimal_point);u("button .wc-order-refund-amount .amount").text(accounting.formatMoney(e,{symbol:woocommerce_admin_meta_boxes.currency_format_symbol,decimal:woocommerce_admin_meta_boxes.currency_format_decimal_sep,thousand:woocommerce_admin_meta_boxes.currency_format_thousand_sep,precision:woocommerce_admin_meta_boxes.currency_format_num_decimals,format:woocommerce_admin_meta_boxes.currency_format}))},refund_quantity_changed:function(){var r=u(this).closest("tr.item"),a=r.find("input.quantity").val(),i=u(this).val(),e=u("input.line_total",r),o=u("input.refund_line_total",r),e=accounting.unformat(e.attr("data-total"),woocommerce_admin.mon_decimal_point)/a;o.val(parseFloat(accounting.formatNumber(e*i,woocommerce_admin_meta_boxes.rounding_precision,"")).toString().replace(".",woocommerce_admin.mon_decimal_point)).trigger("change"),u(".refund_line_tax",r).each(function(){var e=u(this),o=e.data("tax_id"),t=u('input.line_tax[data-tax_id="'+o+'"]',r),o=accounting.unformat(t.data("total_tax"),woocommerce_admin.mon_decimal_point)/a;0<o?(t="yes"===woocommerce_admin_meta_boxes.round_at_subtotal,t=woocommerce_admin_meta_boxes[t?"rounding_precision":"currency_format_num_decimals"],e.val(parseFloat(accounting.formatNumber(o*i,t,"")).toString().replace(".",woocommerce_admin.mon_decimal_point)).trigger("change")):e.val(0).trigger("change")}),0<i?u("#restock_refunded_items").closest("tr").show():(u("#restock_refunded_items").closest("tr").hide(),u(".woocommerce_order_items input.refund_order_item_qty").each(function(){0<u(this).val()&&u("#restock_refunded_items").closest("tr").show()})),u(this).trigger("refund_quantity_changed")}},item_meta:{add:function(){var e=u(this).closest("tr.item, tr.shipping"),o=e.find("tbody.meta_items"),t=o.find("tr").length+1,t='<tr data-meta_id="0"><td><input type="text" maxlength="255" placeholder="'+woocommerce_admin_meta_boxes_order.placeholder_name+'" name="meta_key['+e.attr("data-order_item_id")+"][new-"+t+']" /><textarea placeholder="'+woocommerce_admin_meta_boxes_order.placeholder_value+'" name="meta_value['+e.attr("data-order_item_id")+"][new-"+t+']"></textarea></td><td width="1%"><button class="remove_order_item_meta button">&times;</button></td></tr>';return o.append(t),!1},remove:function(){var e;return window.confirm(woocommerce_admin_meta_boxes.remove_item_meta)&&((e=u(this).closest("tr")).find(":input").val(""),e.hide()),!1}},backbone:{init:function(e,o){"wc-modal-add-products"===o&&(u(document.body).trigger("wc-enhanced-select-init"),u(this).on("change",".wc-product-search",function(){var e,o;u(this).closest("tr").is(":last-child")&&(o=(e=u(this).closest("table.widefat").find("tbody")).find("tr").length,o=e.data("row").replace(/\[0\]/g,"["+o+"]"),e.append("<tr>"+o+"</tr>"),u(document.body).trigger("wc-enhanced-select-init"))}))},response:function(e,o,t){var r,a;if("wc-modal-add-tax"===o&&(r=t.add_order_tax,a="",t.manual_tax_rate_id&&(a=t.manual_tax_rate_id),d.backbone.add_tax(r,a)),"wc-modal-add-products"===o){var o=u(this).find("table.widefat").find("tbody").find("tr"),i=[];return u(o).each(function(){var e=u(this).find(':input[name="item_id"]').val(),o=u(this).find(':input[name="item_qty"]').val();i.push({id:e,qty:o||1})}),d.backbone.add_items(i)}},add_items:function(e){d.block();var o={action:"woocommerce_add_order_item",order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.order_item_nonce,data:e};"true"===u("button.cancel-action").attr("data-reload")&&(o.items=u("table.woocommerce_order_items :input[name], .wc-order-totals-items :input[name]").serialize()),u.ajax({type:"POST",url:woocommerce_admin_meta_boxes.ajax_url,data:o,success:function(e){e.success?(u("#woocommerce-order-items").find(".inside").empty(),u("#woocommerce-order-items").find(".inside").append(e.data.html),e.data.notes_html&&(u("ul.order_notes").empty(),u("ul.order_notes").append(u(e.data.notes_html).find("li"))),d.reloaded_items(),d.unblock()):(d.unblock(),window.alert(e.data.error))},complete:function(){window.wcTracks.recordEvent("order_edit_add_products",{order_id:o.post_id,status:u("#order_status").val()})},dataType:"json"})},add_tax:function(e,o){if(o&&(e=o),!e)return!1;var t,o=u(".order-tax-id").map(function(){return u(this).val()}).get();-1===u.inArray(e,o)?(d.block(),t={action:"woocommerce_add_order_tax",rate_id:e,order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.order_item_nonce},u.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:t,dataType:"json",type:"POST",success:function(e){e.success?(u("#woocommerce-order-items").find(".inside").empty(),u("#woocommerce-order-items").find(".inside").append(e.data.html),d.reloaded_items()):window.alert(e.data.error),d.unblock()},complete:function(){window.wcTracks.recordEvent("order_edit_add_tax",{order_id:t.post_id,status:u("#order_status").val()})}})):window.alert(woocommerce_admin_meta_boxes.i18n_tax_rate_already_exists)}},stupidtable:{init:function(){u(".woocommerce_order_items").stupidtable(),u(".woocommerce_order_items").on("aftertablesort",this.add_arrows)},add_arrows:function(e,o){var t=u(this).find("th"),r="asc"===o.direction?"&uarr;":"&darr;",o=o.column;t.find(".wc-arrow").remove(),t.eq(o).append('<span class="wc-arrow">'+r+"</span>")}}},e={init:function(){u("#woocommerce-order-notes").on("click","button.add_note",this.add_order_note).on("click","a.delete_note",this.delete_order_note)},add_order_note:function(){if(u("textarea#add_order_note").val()){u("#woocommerce-order-notes").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var o={action:"woocommerce_add_order_note",post_id:woocommerce_admin_meta_boxes.post_id,note:u("textarea#add_order_note").val(),note_type:u("select#order_note_type").val(),security:woocommerce_admin_meta_boxes.add_order_note_nonce};return u.post(woocommerce_admin_meta_boxes.ajax_url,o,function(e){u("ul.order_notes .no-items").remove(),u("ul.order_notes").prepend(e),u("#woocommerce-order-notes").unblock(),u("#add_order_note").val(""),window.wcTracks.recordEvent("order_edit_add_order_note",{order_id:o.post_id,note_type:o.note_type||"private",status:u("#order_status").val()})}),!1}},delete_order_note:function(){var e,o;return window.confirm(woocommerce_admin_meta_boxes.i18n_delete_note)&&(e=u(this).closest("li.note"),u(e).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),o={action:"woocommerce_delete_order_note",note_id:u(e).attr("rel"),security:woocommerce_admin_meta_boxes.delete_order_note_nonce},u.post(woocommerce_admin_meta_boxes.ajax_url,o,function(){u(e).remove()})),!1}},o={init:function(){u(".order_download_permissions").on("click","button.grant_access",this.grant_access).on("click","button.revoke_access",this.revoke_access).on("click","#copy-download-link",this.copy_link).on("aftercopy","#copy-download-link",this.copy_success).on("aftercopyfailure","#copy-download-link",this.copy_fail)},grant_access:function(){var e=u("#grant_access_id").val();if(e){u(".order_download_permissions").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});e={action:"woocommerce_grant_access_to_download",product_ids:e,loop:u(".order_download_permissions .wc-metabox").length,order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.grant_access_nonce};return u.post(woocommerce_admin_meta_boxes.ajax_url,e,function(e){e?u(".order_download_permissions .wc-metaboxes").append(e):window.alert(woocommerce_admin_meta_boxes.i18n_download_permission_fail),u(document.body).trigger("wc-init-datepickers"),u("#grant_access_id").val("").trigger("change"),u(".order_download_permissions").unblock()}),!1}},revoke_access:function(){var e,o,t,r;return window.confirm(woocommerce_admin_meta_boxes.i18n_permission_revoke)&&(e=u(this).parent().parent(),o=u(this).attr("rel").split(",")[0],t=u(this).attr("rel").split(",")[1],r=u(this).data("permission_id"),0<o?(u(e).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),r={action:"woocommerce_revoke_access_to_download",product_id:o,download_id:t,permission_id:r,order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.revoke_access_nonce},u.post(woocommerce_admin_meta_boxes.ajax_url,r,function(){u(e).fadeOut("300",function(){u(e).remove()})})):u(e).fadeOut("300",function(){u(e).remove()})),!1},copy_link:function(e){wcClearClipboard(),wcSetClipboard(u(this).attr("href"),u(this)),e.preventDefault()},copy_success:function(){u(this).tipTip({attribute:"data-tip",activation:"focus",fadeIn:50,fadeOut:50,delay:0}).trigger("focus")},copy_fail:function(){u(this).tipTip({attribute:"data-tip-failed",activation:"focus",fadeIn:50,fadeOut:50,delay:0}).trigger("focus")}};p.init(),d.init(),e.init(),o.init()});